import requests
import time
import random
import re
import string as String

EMAIL = "something@gmail.com"   # Your Gmail address
REFERRAL_CODE = ""               #5-6character reservation ID

# Works but runs through same address in same order every run
def dotify(address):
    return dotify_(address.split("@")[0].replace(".","") + "@" + address.split("@")[1])

def dotify_(string):
    if len(string) == 1:
        yield string
        return

    for rest in dotify_(string[1:]):
        yield string[0] + rest
        yield string[0] + "." + rest

# Seems to be patched. Does not work
def plusify(address):
    while True:
        string = ''.join(random.choice(String.ascii_uppercase + String.digits) for _ in range(32))
        yield re.sub('@', '+'+string+'@', address)

# Randomly place dot with following criteria:
# - Not at start or end
# - Atleast two characters inbetween the dot (Seems like only one character seperation is usually rejected)
# High success rate as of 2015/08/08
def random_dotify(address, separator=2):
    split = address.split('@')
    while True:
        account = split[0]
        index = 1
        while index < len(account)-1:
            if random.random() < 0.5:
                account = account[:index] + "." + account[index:]
                index += separator
            index += 1
        yield account + '@' + split[1]

for email in random_dotify(EMAIL):
    requestURL = "https://invites.oneplus.net/index.php?r=share/signup&success_jsonpCallback=success_jsonpCallback&email={0}&koid={1}&_=1438677876942".format(email.replace("@", "%40"), REFERRAL_CODE)
    print("Sending invite to " + email)
    res = requests.get(requestURL)
    while res.status_code != 200:
        print("Request failed. "+str(res.status_code))
        time.sleep(5)
        res = requests.get(requestURL)
    print("Successfully retreived response")
